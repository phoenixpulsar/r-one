<% content_for :title, "Cart · R-One Supply" %>

<div class="grid gap-10 lg:grid-cols-[1.1fr_0.9fr]">
  <div class="rounded-4xl border border-slate-800/70 bg-slate-950/70 p-8">
    <div class="flex items-center justify-between">
      <h1 class="text-2xl font-semibold text-white">Your cart</h1>
      <p class="text-sm text-slate-400"><%= pluralize(@items.sum { |item| item[:quantity] }, 'item') %> ready to fulfill via Printful</p>
    </div>
    <div class="mt-6 space-y-6">
      <% @items.each do |item| %>
        <div class="flex flex-col gap-4 rounded-3xl border border-slate-800/60 bg-slate-900/60 p-5 sm:flex-row sm:items-center">
          <%= image_tag item[:product].primary_image, alt: item[:product].name, class: "h-32 w-32 rounded-2xl border border-slate-800/60 object-cover" %>
          <div class="flex flex-1 flex-col gap-2">
            <div class="flex flex-wrap items-baseline justify-between gap-2">
              <h2 class="text-lg font-semibold text-white"><%= item[:product].name %></h2>
              <p class="text-base font-semibold text-white"><%= number_to_currency(item[:product].price_cents / 100.0) %></p>
            </div>
            <p class="text-sm text-slate-400">Color: <span class="text-slate-200"><%= item[:color] %></span> · Size: <span class="text-slate-200"><%= item[:size] %></span></p>
            <div class="flex flex-wrap items-center gap-3 text-xs">
              <span class="rounded-full border border-slate-700 px-3 py-1 text-slate-300">Stripe SKU · <%= item[:product].printful_sku %></span>
              <span class="rounded-full border border-slate-700 px-3 py-1 text-emerald-300">Ready in Printful</span>
            </div>
            <div class="mt-3 flex flex-wrap items-center gap-3">
              <div class="flex items-center rounded-full border border-slate-700 px-3 py-1 text-sm text-slate-200">
                <button class="px-2 text-slate-500" type="button">−</button>
                <span class="px-3 font-semibold"><%= item[:quantity] %></span>
                <button class="px-2 text-slate-500" type="button">+</button>
              </div>
              <%= link_to "Remove", "#", class: "text-sm font-medium text-rose-300 transition hover:text-rose-200" %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
    <div class="mt-8 rounded-3xl border border-slate-800/60 bg-slate-900/60 p-6 text-sm text-slate-300">
      <p class="font-semibold text-slate-200">Fulfilled by Printful</p>
      <p class="mt-2">Orders sync instantly to Printful. Update mockups, pricing, or variants directly from the product detail page.</p>
      <p class="mt-2 text-xs text-slate-500">Webhooks keep status updates flowing back into the store for customers.</p>
    </div>
  </div>

  <div class="space-y-6">
    <div class="rounded-4xl border border-slate-800/70 bg-slate-950/70 p-8">
      <h2 class="text-lg font-semibold text-white">Order summary</h2>
      <dl class="mt-6 space-y-4 text-sm text-slate-300">
        <div class="flex items-center justify-between">
          <dt>Subtotal</dt>
          <dd><%= number_to_currency(@subtotal_cents / 100.0) %></dd>
        </div>
        <div class="flex items-center justify-between">
          <dt>Shipping</dt>
          <dd><%= number_to_currency(@shipping_cents / 100.0) %></dd>
        </div>
        <div class="flex items-center justify-between">
          <dt>Tax</dt>
          <dd><%= number_to_currency(@tax_cents / 100.0) %></dd>
        </div>
        <div class="flex items-center justify-between border-t border-slate-800/60 pt-4 text-base font-semibold text-white">
          <dt>Total</dt>
          <dd><%= number_to_currency(@total_cents / 100.0) %></dd>
        </div>
      </dl>
      <div class="mt-8 space-y-3">
        <%= link_to "Checkout with Stripe", checkout_path, class: "inline-flex w-full items-center justify-center rounded-full bg-white px-6 py-3 text-sm font-semibold text-slate-900 transition hover:-translate-y-0.5 hover:bg-slate-200" %>
        <%= button_to "Create checkout session", integrations_stripe_checkout_path, params: { cart: { items: @items.map { |item| { id: item[:product].id, quantity: item[:quantity], price_cents: item[:product].price_cents, name: item[:product].name } } } }, class: "inline-flex w-full items-center justify-center rounded-full border border-slate-700 px-6 py-3 text-xs font-semibold uppercase tracking-wide text-slate-200 transition hover:border-cyan-400 hover:text-cyan-300" %>
      </div>
    </div>

    <div class="rounded-4xl border border-slate-800/70 bg-slate-950/70 p-8 text-sm text-slate-300">
      <h3 class="text-base font-semibold text-white">Printful production timeline</h3>
      <ol class="mt-4 space-y-3">
        <li>1. Stripe payment succeeds and posts webhook.</li>
        <li>2. Order is queued via Printful API with variant mapping.</li>
        <li>3. Tracking numbers sync back into customer timeline.</li>
      </ol>
    </div>
  </div>
</div>
