<div class="w-full">
  <div class="bg-white shadow-sm border-b mb-6 -mx-5 px-5 py-6">
    <h1 class="text-3xl font-bold text-gray-900 mb-4">Find Lap Pools</h1>
    
    <%= form_with url: pools_path, method: :get, class: "flex flex-wrap gap-4 items-end", data: { controller: "pool-search" } do |form| %>
      <div class="flex-1 min-w-[200px]">
        <%= form.label :location, "Location", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= form.text_field :location, 
            placeholder: "City, ZIP, or lat,lng", 
            value: params[:location],
            class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500" %>
      </div>
      
      <div class="flex-1 min-w-[150px]">
        <%= form.label "filters[date]", "Date", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= form.date_field "filters[date]", 
            value: @filter_params[:date],
            class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500" %>
      </div>
      
      <div class="flex-1 min-w-[130px]">
        <%= form.label "filters[start_time]", "Time", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= form.time_field "filters[start_time]", 
            value: @filter_params[:start_time],
            class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500" %>
      </div>
      
      <div class="w-32">
        <%= form.label "filters[duration]", "Duration (hrs)", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= form.number_field "filters[duration]", 
            value: @filter_params[:duration] || 1,
            min: 0.5,
            step: 0.5,
            class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500" %>
      </div>
      
      <div class="w-48">
        <%= form.label :sort, "Sort by", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= form.select :sort, 
            [['Name', nil], ['Distance', 'distance'], ['Price', 'price'], ['Earliest Slot', 'earliest_slot'], ['Most Lanes', 'most_lanes']], 
            { selected: params[:sort] },
            class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500" %>
      </div>
      
      <%= form.submit "Search", class: "px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2" %>
    <% end %>
  </div>

  <div class="flex gap-6" data-controller="pool-filters pool-results">
    <div class="hidden lg:block w-80 flex-shrink-0">
      <div class="sticky top-20">
        <%= render 'filter_panel' %>
      </div>
    </div>
    
    <button 
      data-action="click->pool-filters#toggleMobile"
      class="lg:hidden fixed bottom-4 right-4 z-50 px-4 py-3 bg-blue-600 text-white rounded-full shadow-lg hover:bg-blue-700 flex items-center gap-2">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
      </svg>
      Filters
    </button>
    
    <div 
      data-pool-filters-target="overlay"
      class="lg:hidden fixed inset-0 bg-black bg-opacity-50 z-40 hidden"
      data-action="click->pool-filters#closeMobile">
    </div>
    
    <div 
      data-pool-filters-target="mobilePanel"
      class="lg:hidden fixed inset-y-0 left-0 w-80 bg-white shadow-xl z-50 transform -translate-x-full transition-transform duration-300 overflow-y-auto">
      <%= render 'filter_panel', mobile: true %>
    </div>
    
    <div class="flex-1 min-w-0">
      <div class="mb-4 flex flex-wrap gap-2" data-pool-results-target="chips">
        <%= render 'filter_chips' %>
      </div>
      
      <div class="mb-4 flex justify-between items-center">
        <p class="text-sm text-gray-600">
          <%= pluralize(@pools.size, 'pool') %> found
        </p>
        <button 
          data-action="click->pool-results#toggleMap"
          class="px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50 flex items-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"></path>
          </svg>
          <span data-pool-results-target="mapToggleText">Map View</span>
        </button>
      </div>
      
      <div data-pool-results-target="list">
        <% if @pools.any? %>
          <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
            <% @pools.each do |pool| %>
              <%= render 'pool_card', pool: pool %>
            <% end %>
          </div>
        <% else %>
          <div class="text-center py-12">
            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <h3 class="mt-2 text-sm font-medium text-gray-900">No pools found</h3>
            <p class="mt-1 text-sm text-gray-500">Try relaxing your filters or adjusting your search.</p>
          </div>
        <% end %>
      </div>
      
      <div data-pool-results-target="map" class="hidden">
        <div class="bg-gray-100 rounded-lg p-8 text-center" style="height: 600px;" data-controller="pool-map">
          <div class="flex items-center justify-center h-full">
            <div>
              <svg class="mx-auto h-16 w-16 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"></path>
              </svg>
              <h3 class="mt-4 text-lg font-medium text-gray-900">Map View</h3>
              <p class="mt-2 text-sm text-gray-500">Google Maps integration coming soon</p>
              <div class="mt-4 text-xs text-gray-400">
                <% @pools.each do |pool| %>
                  <span data-pool-id="<%= pool.id %>" 
                        data-lat="<%= pool.latitude %>" 
                        data-lng="<%= pool.longitude %>"
                        data-name="<%= pool.name %>" 
                        class="hidden">
                  </span>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
